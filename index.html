<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>大凉国大凉语系雅言语言文字输入法</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body { background:#0b0c2a; color:#fff; font-family:"Microsoft YaHei"; margin:0; padding:10px; }
  h2 { text-align:center; margin-bottom:10px; }
  #inputBox { width:100%; font-size:18px; padding:8px; border-radius:6px; border:none; margin-bottom:10px; }
  #keyboard { display:flex; flex-wrap:wrap; justify-content:center; margin-bottom:20px; }
  .char-btn { background:#f0c000; color:#000; border:none; border-radius:6px; padding:12px; margin:4px; font-size:18px; min-width:50px; cursor:pointer; box-shadow:0 0 6px #f0c00066; }
  .char-btn:hover { transform:scale(1.05); }
  #drawArea { background:#111; border:1px solid #f0c000; border-radius:6px; margin:10px auto; display:block; }
  #drawBtns { text-align:center; margin-top:10px; }
  button { padding:8px 12px; margin:4px; border:none; border-radius:6px; cursor:pointer; }
  #saveBtn { background:#28a745; color:#fff; }
  #loadBtn { background:#007bff; color:#fff; }
  #renderBtn { background:#ffc107; color:#000; }
  #clearBtn { background:#dc3545; color:#fff; }
</style>
</head>
<body>
<h2>大凉国大凉语系雅言语言文字输入法</h2>

<input type="text" id="inputBox" placeholder="在这里输入拉丁字母..." />

<div id="keyboard"></div>

<canvas id="drawArea" width="300" height="300"></canvas>
<div id="drawBtns">
  <button id="saveBtn">保存字符</button>
  <button id="loadBtn">导入字符</button>
  <button id="renderBtn">渲染字符</button>
  <button id="clearBtn">清空画布</button>
</div>

<script>
// ========= 数据存储 =========
let allChars = JSON.parse(localStorage.getItem("stargate_chars")) || { chars: [] };

// ========= 渲染函数 =========
function renderChar(strokes, width, height, ctx) {
  if (!strokes || strokes.length === 0) { ctx.clearRect(0,0,width,height); return; }
  let xs=[],ys=[];
  strokes.forEach(s=>s.forEach(p=>{xs.push(p.x); ys.push(p.y);}));
  const minX=Math.min(...xs), maxX=Math.max(...xs);
  const minY=Math.min(...ys), maxY=Math.max(...ys);
  const padding=5;
  const charWidth=maxX-minX, charHeight=maxY-minY;
  const scale=Math.min((width-2*padding)/charWidth,(height-2*padding)/charHeight)*0.9;
  const offsetX=(width-charWidth*scale)/2 - minX*scale;
  const offsetY=(height-charHeight*scale)/2 - minY*scale;
  ctx.clearRect(0,0,width,height);
  ctx.strokeStyle="#f0c000"; ctx.lineWidth=2; ctx.lineJoin="round"; ctx.lineCap="round";
  strokes.forEach(stroke=>{
    if(stroke.length===0) return;
    ctx.beginPath();
    ctx.moveTo(stroke[0].x*scale+offsetX, stroke[0].y*scale+offsetY);
    for(let i=1;i<stroke.length;i++){
      const prev=stroke[i-1], curr=stroke[i];
      const midX=(prev.x+curr.x)/2, midY=(prev.y+curr.y)/2;
      ctx.quadraticCurveTo(prev.x*scale+offsetX, prev.y*scale+offsetY, midX*scale+offsetX, midY*scale+offsetY);
    }
    ctx.stroke();
  });
}

// ========= 绘制逻辑 =========
const canvas=document.getElementById("drawArea"), ctx=canvas.getContext("2d");
let drawing=false, currentStroke=[];
canvas.addEventListener("mousedown",(e)=>{drawing=true; currentStroke=[{x:e.offsetX,y:e.offsetY}];});
canvas.addEventListener("mousemove",(e)=>{if(drawing){currentStroke.push({x:e.offsetX,y:e.offsetY}); drawTemp();}});
canvas.addEventListener("mouseup",(e)=>{if(drawing){drawing=false; allChars.chars.push({name:prompt("字符名称"),strokes:[currentStroke]}); saveChars(); currentStroke=[]; drawAll();}});
canvas.addEventListener("mouseleave",(e)=>{if(drawing){drawing=false; currentStroke=[]; drawAll();}});
function drawTemp(){drawAll(); ctx.beginPath(); if(currentStroke.length>0){ctx.moveTo(currentStroke[0].x,currentStroke[0].y); for(let i=1;i<currentStroke.length;i++){const p=currentStroke[i],prev=currentStroke[i-1]; const midX=(p.x+prev.x)/2, midY=(p.y+prev.y)/2; ctx.quadraticCurveTo(prev.x,prev.y,midX,midY);} ctx.stroke();}}
function drawAll(){ctx.clearRect(0,0,canvas.width,canvas.height); allChars.chars.forEach(c=>renderChar(c.strokes,canvas.width,canvas.height,ctx));}

// ========= 保存/导入 =========
function saveChars(){localStorage.setItem("stargate_chars",JSON.stringify(allChars));}
document.getElementById("saveBtn").addEventListener("click",()=>{saveChars(); alert("已保存！");});
document.getElementById("clearBtn").addEventListener("click",()=>{ctx.clearRect(0,0,canvas.width,canvas.height); currentStroke=[];});
document.getElementById("renderBtn").addEventListener("click",()=>{drawAll();});
document.getElementById("loadBtn").addEventListener("click",()=>{
  const fileInput=document.createElement("input"); fileInput.type="file"; fileInput.accept=".json";
  fileInput.onchange=e=>{const file=e.target.files[0]; const reader=new FileReader(); reader.onload=ev=>{allChars=JSON.parse(ev.target.result); saveChars(); drawAll();}; reader.readAsText(file);}
  fileInput.click();
});

// ========= 键盘生成 =========
const inputBox=document.getElementById("inputBox");
const keysRow1="qwertyuiop".split("");
const keysRow2="asdfghjkl".split("");
const keysRow3="zxcvbnm".split("");
let caps=false;

function buildKeyboard(){
  const kb=document.getElementById("keyboard");
  kb.innerHTML="";
  const rows=[keysRow1,keysRow2,keysRow3];
  rows.forEach(row=>{
    row.forEach(k=>{
      const btn=document.createElement("button");
      btn.textContent=caps?k.toUpperCase():k;
      btn.className="char-btn";
      btn.onclick=()=>{inputBox.value+=k; updateDisplay();}
      kb.appendChild(btn);
    });
  });
  // 删除键
  const delBtn=document.createElement("button"); delBtn.textContent="删除"; delBtn.className="char-btn";
  delBtn.onclick=()=>{inputBox.value=inputBox.value.slice(0,-1); updateDisplay();}
  kb.appendChild(delBtn);
  // 大小写切换
  const capsBtn=document.createElement("button"); capsBtn.textContent="大小写"; capsBtn.className="char-btn";
  capsBtn.onclick=()=>{caps=!caps; buildKeyboard();}
  kb.appendChild(capsBtn);
}

function updateDisplay(){
  const val=inputBox.value.toLowerCase();
  ctx.clearRect(0,0,canvas.width,canvas.height);
  allChars.chars.forEach(c=>{
    if(c.name.toLowerCase().startsWith(val) && val.length>0){
      renderChar(c.strokes,canvas.width,canvas.height,ctx);
    }
  });
}

buildKeyboard();
inputBox.addEventListener("input",updateDisplay);

</script>
</body>
</html>
